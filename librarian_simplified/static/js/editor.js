// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var errorMessage, form, initPlugin, onSubmit, resizeSection, section, submitForm;
  section = $('#dashboard-simplified');
  form = null;
  errorMessage = templates.dashboardPluginError;
  resizeSection = function(form) {
    return form.parents('section').trigger('remax');
  };
  submitForm = function(form) {
    var data, method, res, url;
    method = form.attr('method');
    url = form.attr('action');
    data = form.serialize();
    res = $.ajax({
      url: url,
      data: data,
      type: method
    });
    res.done(function(result) {
      form.replaceWith(result);
      return initPlugin();
    });
    return res.fail(function(xhr) {
      form.prepend(errorMessage);
      return resizeSection(form);
    });
  };
  onSubmit = function(e) {
    e.preventDefault();
    form = $(this);
    return submitForm(form);
  };
  initPlugin = function() {
    form = section.find('form');
    form.on('submit', onSubmit);
    return resizeSection(form);
  };
  return section.on('dashboard-plugin-loaded', initPlugin);
})(this, this.jQuery, this.templates);
